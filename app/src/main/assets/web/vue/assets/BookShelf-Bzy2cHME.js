import{d as F,a4 as oe,o as c,e as u,h as t,F as N,R as W,z as g,c as K,w as V,g as D,a5 as Y,P as L,u as o,C as z,Q as ae,a6 as ne,a7 as re,U as le,f as I,O as ie,G as ce,H as O,D as de,y as T,a2 as ue,a1 as pe,M as C,s as he,n as U,a8 as ge}from"./vendor-CXAXXqoJ.js";import{d as ve,A as y,i as me,_ as G,u as fe,a as _e,l as we,s as Be,p as ye,b as Z,v as ke}from"./index-CIakoYy1.js";import{u as Se}from"./loading-DRmI9rMI.js";const Ae={class:"books-wrapper"},Ie={class:"wrapper"},Ce=["onClick"],xe={class:"cover-img"},Re=["src"],Ee={class:"info"},be={class:"name"},Le={class:"sub"},Ve={class:"author"},ze={key:0,class:"tags"},Me={key:1,class:"update-info"},Pe={class:"size"},Te={class:"date"},Ue={key:0,class:"intro"},Ne={key:1,class:"dur-chapter"},We={class:"last-chapter"},De=F({__name:"BookItems",props:{books:{},isSearch:{type:Boolean}},emits:["bookClick"],setup(w,{emit:a}){oe(v=>({v2a51eeb0:o(k)}));const x=w,M=a,n=v=>M("bookClick",v),R=({bookUrl:v,coverUrl:l})=>l===void 0?y.getProxyCoverUrl(v):me(l)?y.getProxyCoverUrl(l):l,E=v=>{const l=v.target;l.src=y.getProxyCoverUrl(l.src)},k=z(()=>x.isSearch?"space-between":"flex-start");return(v,l)=>{const m=Y;return c(),u("div",Ae,[t("div",Ie,[(c(!0),u(N,null,W(w.books,r=>{var i;return c(),u("div",{class:"book",key:r.bookUrl,onClick:_=>n(r)},[t("div",xe,[(c(),u("img",{class:"cover",src:R(r),key:r.coverUrl,onErrorOnce:E,alt:"",loading:"lazy"},null,40,Re))]),t("div",Ee,[t("div",be,g(r.name),1),t("div",Le,[t("div",Ve,g(r.author),1),w.isSearch?(c(),u("div",ze,[(c(!0),u(N,null,W((i=r.kind)==null?void 0:i.split(",").slice(0,2),_=>(c(),K(m,{key:_},{default:V(()=>[D(g(_),1)]),_:2},1024))),128))])):L("",!0),w.isSearch?L("",!0):(c(),u("div",Me,[l[0]||(l[0]=t("div",{class:"dot"},"•",-1)),t("div",Pe,"共"+g(r.totalChapterNum)+"章",1),l[1]||(l[1]=t("div",{class:"dot"},"•",-1)),t("div",Te,g(o(ve)(r.lastCheckTime)),1)]))]),w.isSearch?(c(),u("div",Ue,g(r.intro),1)):L("",!0),w.isSearch?L("",!0):(c(),u("div",Ne," 已读："+g(r.durChapterTitle),1)),t("div",We,"最新："+g(r.latestChapterTitle),1)])],8,Ce)}),128))])])}}}),He=G(De,[["__scopeId","data-v-0f5f0160"]]),Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Oe={class:"navigation-wrapper"},Ze={class:"search-wrapper"},Fe={class:"bottom-wrapper"},Ke={class:"recent-wrapper"},Ye={class:"reading-recent"},Ge={class:"group-wrapper"},Qe={class:"group-selector"},qe={class:"setting-wrapper"},Xe={class:"setting-item"},$e={class:"bottom-icons"},je={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},et={class:"bottom-icon"},tt=["src"],st=F({__name:"BookShelf",setup(w){const a=fe(),x=z(()=>a.isNight),M=s=>{try{s!==void 0&&a.setConfig(s)}catch{U.info("阅读界面配置解析错误")}},n=C({name:"尚无阅读记录",author:"",bookUrl:"",chapterIndex:0,chapterPos:0,isSeachBook:!1}),R=C(),{showLoading:E,closeLoading:k,loadingWrapper:v,isLoading:l}=Se(R,"正在获取书籍信息"),m=he([]),r=z(()=>a.shelf),i=C(""),_=C(!1),P=z(()=>a.groups),S=C(void 0);ae(()=>{if(!(_.value&&i.value!="")){if(_.value=!1,m.value=[],i.value==""){m.value=r.value;return}m.value=r.value.filter(s=>s.name.includes(i.value)||s.author.includes(i.value))}});const H=()=>{i.value!=""&&(m.value=[],a.clearSearchBooks(),E(),_.value=!0,y.search(i.value,s=>{l&&k();try{a.setSearchBooks(s),m.value=a.searchBooks}catch(e){throw U.error("后端数据错误"),e}},()=>{k(),m.value.length==0&&U.info("搜索结果为空")}))},b=_e(),{connectStatus:Q,connectType:q,newConnect:X}=ne(b),$=()=>{ge.prompt("请输入 后端地址 ( 如：http://127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:we,inputValidator:s=>ke(s),inputErrorMessage:"输入的格式不对",beforeClose:(s,e,f)=>{if(s==="confirm"){b.setNewConnect(!0),e.confirmButtonLoading=!0,e.confirmButtonText="校验中……";const d=new URL(e.inputValue).toString();y.getReadConfig(d).then(function(p){b.setNewConnect(!1),M(p),e.confirmButtonLoading=!1,a.clearSearchBooks(),Be(...ye(d)),d===location.origin?localStorage.removeItem(Z):localStorage.setItem(Z,d),a.loadBookShelf(),f()}).catch(function(p){throw b.setNewConnect(!1),e.confirmButtonLoading=!1,e.confirmButtonText="确定",p})}else f()}})},j=re(),ee=async s=>{const e="respondTime"in s;e&&await y.saveBook(s);const{bookUrl:f,name:d,author:p,durChapterIndex:B=0,durChapterPos:A=0}=s;J(f,d,p,B,A,e)},J=(s,e,f,d,p,B=!1,A=!1)=>{if(e!=="尚无阅读记录"){if(A&&r.value.every(h=>h.bookUrl!==s)){i.value=e,H();return}sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",e),sessionStorage.setItem("bookAuthor",f),sessionStorage.setItem("chapterIndex",String(d)),sessionStorage.setItem("chapterPos",String(p)),sessionStorage.setItem("isSeachBook",String(B)),n.value={name:e,author:f,bookUrl:s,chapterIndex:d,chapterPos:p,isSeachBook:B},localStorage.setItem("readingRecent",JSON.stringify(n.value)),j.push({path:"/chapter"})}},te=async()=>{await a.loadWebConfig(),await a.saveBookProgress(),await a.loadGroups(),P.value.length>0?(S.value=P.value[0].groupId,await a.loadBookShelf(S.value)):await a.loadBookShelf()},se=async s=>{E();try{await a.loadBookShelf(s)}finally{k()}};return le(()=>{const s=localStorage.getItem("readingRecent");s!=null&&(n.value=JSON.parse(s),typeof n.value.chapterIndex>"u"&&(n.value.chapterIndex=0)),v(te())}),(s,e)=>{const f=de,d=Y,p=ue,B=pe,A=He;return c(),u("div",{class:T({"index-wrapper":!0,night:o(x),day:!o(x)})},[t("div",Oe,[e[6]||(e[6]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Ze,[I(f,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:o(i),"onUpdate:modelValue":e[0]||(e[0]=h=>O(i)?i.value=h:null),class:"search-input","prefix-icon":o(ce),onKeyup:ie(H,["enter"])},null,8,["modelValue","prefix-icon"])]),t("div",Fe,[t("div",Ke,[e[3]||(e[3]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",Ye,[I(d,{type:o(n).name=="尚无阅读记录"?"warning":"primary",class:T(["recent-book",{"no-point":o(n).bookUrl==""}]),size:"large",onClick:e[1]||(e[1]=h=>J(o(n).bookUrl,o(n).name,o(n).author,o(n).chapterIndex,o(n).chapterPos,o(n).isSeachBook,!0))},{default:V(()=>[D(g(o(n).name),1)]),_:1},8,["type","class"])])]),t("div",Ge,[e[4]||(e[4]=t("div",{class:"group-title"},"书架分组",-1)),t("div",Qe,[I(B,{modelValue:o(S),"onUpdate:modelValue":e[2]||(e[2]=h=>O(S)?S.value=h:null),placeholder:"选择分组",onChange:se,class:"group-select"},{default:V(()=>[(c(!0),u(N,null,W(o(P),h=>(c(),K(p,{key:h.groupId,label:h.groupName,value:h.groupId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",qe,[e[5]||(e[5]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",Xe,[I(d,{type:o(q),size:"large",class:T(["setting-connect",{"no-point":o(X)}]),onClick:$},{default:V(()=>[D(g(o(Q)),1)]),_:1},8,["type","class"])])])]),t("div",$e,[t("a",je,[t("div",et,[t("img",{src:o(Je),alt:""},null,8,tt)])])])]),t("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:R},[I(A,{books:o(m),onBookClick:ee,isSearch:o(_)},null,8,["books","isSearch"])],512)],2)}}}),rt=G(st,[["__scopeId","data-v-b7359630"]]);export{rt as default};
